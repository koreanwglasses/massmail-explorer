!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=React},function(t,e){t.exports=d3},function(t,e){t.exports=ReactDOM},function(t,e,n){"use strict";n.r(e);var r=n(0),i=n(2),o=n(1);const l=function(t,e){return[t*e[0],t*e[1]]},a=function(t,e){return[t[0]+e[0],t[1]+e[1]]},c=function(t,e){const n=[t[1]-e[1],e[0]-t[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/r,n[1]/r]},s=function(t,e){const n=[t[0][0],t[0][1]-e];return"M "+n+" A "+[e,e,"0,0,0",[t[0][0],t[0][1]+e]].join(",")+" A "+[e,e,"0,0,0",n].join(",")},u=function(t,e){const n=l(e,c(t[0],t[1])),r=l(-1,n),i=a(t[0],n),o=a(t[1],n),s=a(t[1],r),u=a(t[0],r);return"M "+i+" L "+o+" A "+[e,e,"0,0,0",s].join(",")+" L "+u+" A "+[e,e,"0,0,0",i].join(",")};function d(t,e=((...t)=>t.reduce((t,e)=>`${t},${e}`,""))){const n=new Map;return Object.assign((function(...r){const i=e(...r);return n.has(i)||n.set(i,t(...r)),n.get(i)}),{invalidate(){n.clear()}})}function f({data:t,width:e,height:n,selectedWords:i=[],mode:f="ORIGINAL",onData:p=(()=>{}),hideOutlines:m=!1}){const h=[-50,-50,100],g=r.useRef(d((function(t,n,r){const i=y.current,o=t=>e/h[2]*(t-h[0]),l=t=>e/h[2]*(t-h[1]);if("ORIGINAL"===r)return[o(n.embedding.x),l(n.embedding.y)];if("EXPLODED"===r){const e=t.clusters.findIndex(({id:t})=>t===n.clusterId),a=i(t,t.clusters[e],"ORIGINAL");if(0===e)return[-a.left+o(n.embedding.x),-a.top+l(n.embedding.y)];const c=i(t,t.clusters[e-1],r);return c.right+a.width<4e3?[50+c.right-a.left+o(n.embedding.x),c.top+-a.top+l(n.embedding.y)]:[-a.left+o(n.embedding.x),1200+c.top+-a.top+l(n.embedding.y)]}}),(t,e,n)=>`${e.embedding.x},${e.embedding.y},${n}`));r.useEffect(()=>{g.current.invalidate()},[t]);const x=r.useRef(d((function(t,e,n){const r=g.current;return t.emails.filter(t=>t.clusterId===e.id).map(e=>r(t,e,n))}),(t,{id:e},n)=>`${e},${n}`));r.useEffect(()=>{x.current.invalidate()},[t]);const y=r.useRef(d((function(t,e,n){const r=(0,x.current)(t,e,n),[i,l]=o.extent(r.map(([t,e])=>t)),[a,c]=o.extent(r.map(([t,e])=>e));return{left:i,right:l,top:a,bottom:c,width:l-i,height:c-a}}),(t,{id:e},n)=>`${e},${n}`));const b=r.useRef(),w=r.useRef(),E=r.useRef();function v(){const{circleG:e}=E.current,n=o.select(w.current),r=g.current;e.selectAll("circle").data(t.emails).join("circle").call(e=>e.transition("email-spatial-view-mode").duration(2e3).attr("cx",e=>r(t,e,f)[0]).attr("cy",e=>r(t,e,f)[1])).call(t=>t.transition("email-spatial-view-focus").duration(500).style("opacity",t=>!i.length||i.map(e=>t.content.includes(e)).reduce((t,e)=>t||e,!1)?1:.1)).attr("r",8).attr("fill","transparent").attr("stroke",t=>`hsl(${18*+t.clusterId}, 100%, 30%)`).attr("stroke-width","2px").on("mouseenter",(function(t,e){n.text(e.content||"(no content)").style("left",t.offsetX+"px").style("top",t.offsetY+"px").style("opacity",100)})).on("mousemove",(function(t,e){n.style("left",t.offsetX+"px").style("top",t.offsetY+"px")})).on("mouseleave",(function(t,e){n.style("opacity",0)})).call(o.drag().on("start",(function(){o.select(this).raise(),e.attr("cursor","grabbing")})).on("drag",(function(t,e){o.select(this).attr("cx",t.x).attr("cy",t.y)})).on("end",(function(e,n){const r=function(t){const[e,n]=o.pointer(t);return document.elementsFromPoint(e,n).find(t=>"path"===t.tagName)}(e);if(r){const e=o.select(r).datum();p(function(e,n){const r={...t,emails:[...t.emails]};return r.emails[r.emails.indexOf(e)]={...e,clusterId:n.id},r}(n,e))}else p(function(e){const n={id:Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),label:t.clusters.find(({id:t})=>e.clusterId===t).label},r={...t,clusters:[...t.clusters,n],emails:[...t.emails]};return r.emails[r.emails.indexOf(e)]={...e,clusterId:n.id},r}(n))})))}function O(){const{clusterG:e}=E.current,n=x.current;e.selectAll("path").data(t.clusters).join("path").style("stroke",t=>`hsl(${18*+t.id}, 100%, 50%)`).style("stroke-width","2px").style("fill",t=>`hsla(${18*+t.id}, 100%, 90%, 0.2)`).call(e=>e.transition("email-spatial-view-mode").duration(2e3).attr("d",e=>{const r=n(t,e,f);return function(t,e){if(!t||t.length<1)return"";if(1===t.length)return s(t,e);if(2===t.length)return u(t,e);let n=new Array(t.length);for(let r=0;r<n.length;++r){const i=0===r?t[t.length-1]:t[r-1],o=t[r],s=l(e,c(i,o));n[r]=[a(i,s),a(o,s)]}const r="A "+[e,e,"0,0,0,"].join(",");return n=n.map((function(t,e){let i="";return 0===e&&(i="M "+n[n.length-1][1]+" "),i+=r+t[0]+" L "+t[1],i})),n.join(" ")}(r.length<3?r:o.polygonHull(r),15)})).call(t=>t.transition("email-spatial-view-focus").duration(500).style("opacity",t=>m?.1:i.length&&-1==i.indexOf(t.label)?.2:1))}function j(){const{labelG:e}=E.current,n=x.current;e.selectAll("text").data(t.clusters).join("text").attr("text-anchor","middle").style("font-size","30px").text(t=>t.label).call(e=>e.transition("email-spatial-view-mode").duration(2e3).attr("x",e=>{const r=n(t,e,f);return r.length?o.mean(o.extent(r.map(([t,e])=>t))):0}).attr("y",e=>{const r=n(t,e,f);return r.length?o.min(r.map(([t,e])=>e))-15-5:0})).call(t=>t.transition("email-spatial-view-focus").duration(500).style("opacity",t=>i.length&&-1==i.indexOf(t.label)?.24:1))}return r.useEffect(()=>{!function(){const t=o.select(b.current),e=t.append("g"),n=e.append("g"),r=e.append("g"),i=e.append("g");t.attr("font-family","sans-serif"),r.attr("cursor","grab"),E.current={svg:t,zoomG:e,clusterG:n,circleG:r,labelG:i}}(),v(),O(),j(),y.current(t,t.clusters[t.clusters.length-1],"EXPLODED")},[]),r.useEffect(()=>{!function(){const{svg:t,zoomG:r}=E.current;t.attr("viewBox",[0,0,e,n]).call(o.zoom().extent([[0,0],[e,n]]).scaleExtent([.25,8]).on("zoom",({transform:t})=>r.attr("transform",t)))}()},[e,n]),r.useEffect(()=>{v(),O(),j()},[f,t,i]),r.useEffect(()=>{O()},[m]),r.createElement("div",{style:{position:"fixed",left:110,top:0,height:n+"px",width:e-110+"px"}},r.createElement("svg",{width:e,height:n,ref:b}),r.createElement("div",{ref:w,style:{opacity:0,position:"absolute",pointerEvents:"none",backgroundColor:"white",maxWidth:"300px",maxHeight:"400px",overflow:"hidden",padding:"5px",border:"2px solid black"}}))}i.render(r.createElement((function(){const[t,e]=r.useState(),n=t?t.clusters.map(({label:t})=>t):void 0;r.useEffect(()=>{(async()=>{const t=await fetch("../data/data.json");e(await t.json())})()},[]);const[i,o]=r.useState("ORIGINAL");window.setMode=o;const[[l,a],c]=r.useState([window.innerWidth,window.innerHeight]);window.addEventListener("resize",()=>c([window.innerWidth,window.innerHeight]));const[s,u]=r.useState([]),[d,p]=r.useState(!1);return r.createElement("div",{style:{fontFamily:"sans-serif"}},t&&r.createElement(f,{width:l,height:a,data:t,selectedWords:s,mode:i,onData:e,hideOutlines:d}),r.createElement("h1",null,"Massmail Explorer"),r.createElement("input",{type:"button",value:"Original",onClick:()=>o("ORIGINAL")}),r.createElement("br",null),r.createElement("input",{type:"button",value:"Exploded",onClick:()=>o("EXPLODED")}),r.createElement("br",null),r.createElement("input",{type:"checkbox",defaultChecked:d,onClick:t=>p(t.target.checked)}),"Fade Outlines",r.createElement("div",null,r.createElement("h2",null,"Keywords"),n&&n.map((t,e)=>r.createElement("input",{type:"button",value:t,key:e,style:{display:"flex",width:100,height:50,justifyContent:"center",alignItems:"center",borderStyle:"solid",borderWidth:"2px",borderColor:"black",borderRadius:"0px",marginBottom:"1px",backgroundColor:-1==s.indexOf(t)?"white":"black",color:-1==s.indexOf(t)?"black":"white"},onClick:()=>u(-1==s.indexOf(t)?[t]:[])}))))}),null),document.getElementById("react-root"))}]);
//# sourceMappingURL=main.js.map