!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=React},function(t,e){t.exports=d3},function(t,e){t.exports=ReactDOM},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n(2),i=n(1);const l=function(t,e){return[t*e[0],t*e[1]]},c=function(t,e){return[t[0]+e[0],t[1]+e[1]]},s=function(t,e){const n=[t[1]-e[1],e[0]-t[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/r,n[1]/r]},a=function(t,e){const n=[t[0][0],t[0][1]-e];return"M "+n+" A "+[e,e,"0,0,0",[t[0][0],t[0][1]+e]].join(",")+" A "+[e,e,"0,0,0",n].join(",")},u=function(t,e){const n=l(e,s(t[0],t[1])),r=l(-1,n),o=c(t[0],n),i=c(t[1],n),a=c(t[1],r),u=c(t[0],r);return"M "+o+" L "+i+" A "+[e,e,"0,0,0",a].join(",")+" L "+u+" A "+[e,e,"0,0,0",o].join(",")};function d(t,e=((...t)=>t.reduce((t,e)=>`${t},${e}`,""))){const n=new Map;return Object.assign((function(...r){const o=e(...r);return n.has(o)||n.set(o,t(...r)),n.get(o)}),{invalidate(){n.clear()}})}function f({data:t,width:e,height:n,selectedWords:o=[],mode:f="ORIGINAL",onData:m=(()=>{})}){const p=[-50,-50,100],g=r.useRef(d((function(t,n,r){const o=y.current,i=t=>e/p[2]*(t-p[0]),l=t=>e/p[2]*(t-p[1]);if("ORIGINAL"===r)return[i(n.embedding.x),l(n.embedding.y)];if("EXPLODED"===r){const e=t.clusters.findIndex(({id:t})=>t===n.clusterId),c=o(t,t.clusters[e],"ORIGINAL");if(0===e)return[-c.left+i(n.embedding.x),-c.top+l(n.embedding.y)];const s=o(t,t.clusters[e-1],r);return s.right+c.width<3e3?[30+s.right-c.left+i(n.embedding.x),s.top+-c.top+l(n.embedding.y)]:[-c.left+i(n.embedding.x),1200+s.top+-c.top+l(n.embedding.y)]}}),(t,e,n)=>`${e.embedding.x},${e.embedding.y},${n}`));r.useEffect(()=>{g.current.invalidate()},[t]);const h=r.useRef(d((function(t,e,n){const r=g.current;return t.emails.filter(t=>t.clusterId===e.id).map(e=>r(t,e,n))}),(t,{id:e},n)=>`${e},${n}`));r.useEffect(()=>{h.current.invalidate()},[t]);const y=r.useRef(d((function(t,e,n){const r=(0,h.current)(t,e,n),[o,l]=i.extent(r.map(([t,e])=>t)),[c,s]=i.extent(r.map(([t,e])=>e));return{left:o,right:l,top:c,bottom:s,width:l-o,height:s-c}}),(t,{id:e},n)=>`${e},${n}`));const x=r.useRef(),b=r.useRef(),w=r.useRef();function E(){const{circleG:e}=w.current,n=i.select(b.current),r=g.current;e.selectAll("circle").data(t.emails).join("circle").call(e=>e.transition("email-spatial-view-mode").duration(2e3).attr("cx",e=>r(t,e,f)[0]).attr("cy",e=>r(t,e,f)[1]).style("opacity",t=>!o.length||o.map(e=>t.content.includes(e)).reduce((t,e)=>t||e,!1)?1:.1)).attr("r",4).attr("fill","#888").on("mouseenter",(function(t,e){n.text(e.content||"(no content)").style("left",t.clientX+window.scrollX+"px").style("top",t.clientY+window.scrollY+"px").style("opacity",100)})).on("mousemove",(function(t,e){n.style("left",t.clientX+window.scrollX+"px").style("top",t.clientY+window.scrollY+"px")})).on("mouseleave",(function(t,e){n.style("opacity",0)})).call(i.drag().on("start",(function(){i.select(this).raise(),e.attr("cursor","grabbing")})).on("drag",(function(t,e){i.select(this).attr("cx",t.x).attr("cy",t.y)})).on("end",(function(e,n){const r=function(t){const[e,n]=i.pointer(t);return document.elementsFromPoint(e,n).find(t=>"path"===t.tagName)}(e);if(r){const e=i.select(r).datum();m(function(e,n){const r={...t,emails:[...t.emails]};return r.emails[r.emails.indexOf(e)]={...e,clusterId:n.id},r}(n,e))}else m(function(e){const n={id:Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),label:t.clusters.find(({id:t})=>e.clusterId===t).label},r={...t,clusters:[...t.clusters,n],emails:[...t.emails]};return r.emails[r.emails.indexOf(e)]={...e,clusterId:n.id},r}(n))})))}function v(){const{clusterG:e}=w.current,n=h.current;e.selectAll("path").data(t.clusters).join("path").style("stroke","#888").style("stroke-width","2px").style("fill","#eee").call(e=>e.transition("email-spatial-view-mode").duration(2e3).style("opacity",{ORIGINAL:.2,EXPLODED:1}[f]).attr("d",e=>{const r=n(t,e,f);return function(t,e){if(!t||t.length<1)return"";if(1===t.length)return a(t,e);if(2===t.length)return u(t,e);let n=new Array(t.length);for(let r=0;r<n.length;++r){const o=0===r?t[t.length-1]:t[r-1],i=t[r],a=l(e,s(o,i));n[r]=[c(o,a),c(i,a)]}const r="A "+[e,e,"0,0,0,"].join(",");return n=n.map((function(t,e){let o="";return 0===e&&(o="M "+n[n.length-1][1]+" "),o+=r+t[0]+" L "+t[1],o})),n.join(" ")}(r.length<3?r:i.polygonHull(r),10)}))}function O(){const{labelG:e}=w.current,n=h.current;e.selectAll("text").data(t.clusters).join("text").attr("text-anchor","middle").text(t=>t.label).call(e=>e.transition("email-spatial-view-mode").duration(2e3).attr("x",e=>{const r=n(t,e,f);return r.length?i.mean(i.extent(r.map(([t,e])=>t))):0}).attr("y",e=>{const r=n(t,e,f);return r.length?i.min(r.map(([t,e])=>e))-10-5:0}))}return r.useEffect(()=>{!function(){const t=i.select(x.current),e=t.append("g"),n=e.append("g"),r=e.append("g"),o=e.append("g");t.attr("font-family","sans-serif"),r.attr("cursor","grab"),w.current={svg:t,zoomG:e,clusterG:n,circleG:r,labelG:o}}(),E(),v(),O(),y.current(t,t.clusters[t.clusters.length-1],"EXPLODED")},[]),r.useEffect(()=>{!function(){const{svg:t,zoomG:r}=w.current;t.attr("viewBox",[0,0,e,n]).call(i.zoom().extent([[0,0],[e,n]]).scaleExtent([.25,8]).on("zoom",({transform:t})=>r.attr("transform",t)))}()},[e,n]),r.useEffect(()=>{E(),v(),O()},[f,t]),r.createElement("div",{style:{position:"fixed",left:110,top:0,height:n+"px",width:e-110+"px"}},r.createElement("svg",{width:e,height:n,ref:x}),r.createElement("div",{ref:b,style:{opacity:0,position:"absolute",pointerEvents:"none",backgroundColor:"white",maxWidth:"300px",maxHeight:"400px",overflow:"hidden",padding:"5px",border:"2px solid black"}}))}o.render(r.createElement((function(){const[t,e]=r.useState(),n=t?t.clusters.map(({label:t})=>t):void 0;r.useEffect(()=>{(async()=>{const t=await fetch("/data/data.json");e(await t.json())})()},[]);const[o,i]=r.useState("ORIGINAL");window.setMode=i;const[[l,c],s]=r.useState([window.innerWidth,window.innerHeight]);return window.addEventListener("resize",()=>s([window.innerWidth,window.innerHeight])),r.createElement("div",{style:{fontFamily:"sans-serif"}},t&&r.createElement(f,{width:l,height:c,data:t,selectedWords:[],mode:o,onData:e}),r.createElement("h1",null,"Massmail Explorer"),r.createElement("input",{type:"button",value:"Original",onClick:()=>i("ORIGINAL")}),r.createElement("input",{type:"button",value:"Exploded",onClick:()=>i("EXPLODED")}),r.createElement("div",null,r.createElement("h2",null,"Keywords"),n&&n.map(t=>r.createElement("input",{type:"button",value:t,style:{display:"flex",width:100,height:50,justifyContent:"center",alignItems:"center"}}))))}),null),document.getElementById("react-root"))}]);
//# sourceMappingURL=main.js.map