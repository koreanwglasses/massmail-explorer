!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=React},function(e,t){e.exports=d3},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(2),o=n(1);const l=function(e,t){return[e*t[0],e*t[1]]},a=function(e,t){return[e[0]+t[0],e[1]+t[1]]},c=function(e,t){const n=[e[1]-t[1],t[0]-e[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/r,n[1]/r]},s=function(e,t){const n=[e[0][0],e[0][1]-t];return"M "+n+" A "+[t,t,"0,0,0",[e[0][0],e[0][1]+t]].join(",")+" A "+[t,t,"0,0,0",n].join(",")},u=function(e,t){const n=l(t,c(e[0],e[1])),r=l(-1,n),i=a(e[0],n),o=a(e[1],n),s=a(e[1],r),u=a(e[0],r);return"M "+i+" L "+o+" A "+[t,t,"0,0,0",s].join(",")+" L "+u+" A "+[t,t,"0,0,0",i].join(",")};function d(e,t=((...e)=>e.reduce((e,t)=>`${e},${t}`,""))){const n=new Map;return Object.assign((function(...r){const i=t(...r);return n.has(i)||n.set(i,e(...r)),n.get(i)}),{invalidate(){n.clear()}})}function f({data:e,width:t,height:n,selectedWords:i=[],mode:f="ORIGINAL",onData:m=(()=>{}),hideOutlines:p=!1}){const h=[-50,-50,100],g=r.useRef(d((function(e,n,r){const i=y.current,o=e=>t/h[2]*(e-h[0]),l=e=>t/h[2]*(e-h[1]);if("ORIGINAL"===r)return[o(n.embedding.x),l(n.embedding.y)];if("EXPLODED"===r){const t=e.clusters.findIndex(({id:e})=>e===n.clusterId),a=i(e,e.clusters[t],"ORIGINAL");if(0===t)return[-a.left+o(n.embedding.x),-a.top+l(n.embedding.y)];const c=i(e,e.clusters[t-1],r);return c.right+a.width<4e3?[50+c.right-a.left+o(n.embedding.x),c.top+-a.top+l(n.embedding.y)]:[-a.left+o(n.embedding.x),1200+c.top+-a.top+l(n.embedding.y)]}}),(e,t,n)=>`${t.embedding.x},${t.embedding.y},${n}`));r.useEffect(()=>{g.current.invalidate()},[e]);const x=r.useRef(d((function(e,t,n){const r=g.current;return e.emails.filter(e=>e.clusterId===t.id).map(t=>r(e,t,n))}),(e,{id:t},n)=>`${t},${n}`));r.useEffect(()=>{x.current.invalidate()},[e]);const y=r.useRef(d((function(e,t,n){const r=(0,x.current)(e,t,n),[i,l]=o.extent(r.map(([e,t])=>e)),[a,c]=o.extent(r.map(([e,t])=>t));return{left:i,right:l,top:a,bottom:c,width:l-i,height:c-a}}),(e,{id:t},n)=>`${t},${n}`));const b=r.useRef(),w=r.useRef(),E=r.useRef();function v(){const{circleG:t}=E.current,n=o.select(w.current),r=g.current;t.selectAll("circle").data(e.emails).join("circle").call(t=>t.transition("email-spatial-view-mode").duration(2e3).attr("cx",t=>r(e,t,f)[0]).attr("cy",t=>r(e,t,f)[1])).call(e=>e.transition("email-spatial-view-focus").duration(500).style("opacity",e=>!i.length||i.map(t=>e.content.includes(t)).reduce((e,t)=>e||t,!1)?1:.1)).attr("r",8).attr("fill","transparent").attr("stroke",e=>`hsl(${18*+e.clusterId}, 100%, 30%)`).attr("stroke-width","2px").on("mouseenter",(function(e,t){n.text(t.content||"(no content)").style("left",e.offsetX+"px").style("top",e.offsetY+"px").style("opacity",100)})).on("mousemove",(function(e,t){n.style("left",e.offsetX+"px").style("top",e.offsetY+"px")})).on("mouseleave",(function(e,t){n.style("opacity",0)})).call(o.drag().on("start",(function(){o.select(this).raise(),t.attr("cursor","grabbing")})).on("drag",(function(e,t){o.select(this).attr("cx",e.x).attr("cy",e.y)})).on("end",(function(t,n){const r=function(e){const[t,n]=o.pointer(e);return document.elementsFromPoint(t,n).find(e=>"path"===e.tagName)}(t);if(r){const t=o.select(r).datum();m(function(t,n){const r={...e,emails:[...e.emails]};return r.emails[r.emails.indexOf(t)]={...t,clusterId:n.id},r}(n,t))}else m(function(t){const n={id:Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),label:e.clusters.find(({id:e})=>t.clusterId===e).label},r={...e,clusters:[...e.clusters,n],emails:[...e.emails]};return r.emails[r.emails.indexOf(t)]={...t,clusterId:n.id},r}(n))})))}function O(){const{clusterG:t}=E.current,n=x.current;t.selectAll("path").data(e.clusters).join("path").style("stroke",e=>`hsl(${18*+e.id}, 100%, 50%)`).style("stroke-width","2px").style("fill",e=>`hsla(${18*+e.id}, 100%, 90%, 0.2)`).call(t=>t.transition("email-spatial-view-mode").duration(2e3).attr("d",t=>{const r=n(e,t,f);return function(e,t){if(!e||e.length<1)return"";if(1===e.length)return s(e,t);if(2===e.length)return u(e,t);let n=new Array(e.length);for(let r=0;r<n.length;++r){const i=0===r?e[e.length-1]:e[r-1],o=e[r],s=l(t,c(i,o));n[r]=[a(i,s),a(o,s)]}const r="A "+[t,t,"0,0,0,"].join(",");return n=n.map((function(e,t){let i="";return 0===t&&(i="M "+n[n.length-1][1]+" "),i+=r+e[0]+" L "+e[1],i})),n.join(" ")}(r.length<3?r:o.polygonHull(r),15)})).call(e=>e.transition("email-spatial-view-focus").duration(500).style("opacity",e=>p?.1:i.length&&-1==i.indexOf(e.label)?.2:1))}function j(){const{labelG:t}=E.current,n=x.current;t.selectAll("text").data(e.clusters).join("text").attr("text-anchor","middle").style("font-size","30px").text(e=>e.label).call(t=>t.transition("email-spatial-view-mode").duration(2e3).attr("x",t=>{const r=n(e,t,f);return r.length?o.mean(o.extent(r.map(([e,t])=>e))):0}).attr("y",t=>{const r=n(e,t,f);return r.length?o.min(r.map(([e,t])=>t))-15-5:0})).call(e=>e.transition("email-spatial-view-focus").duration(500).style("opacity",e=>i.length&&-1==i.indexOf(e.label)?.24:1))}return r.useEffect(()=>{!function(){const e=o.select(b.current),t=e.append("g"),n=t.append("g"),r=t.append("g"),i=t.append("g");e.attr("font-family","sans-serif"),r.attr("cursor","grab"),E.current={svg:e,zoomG:t,clusterG:n,circleG:r,labelG:i}}(),v(),O(),j(),y.current(e,e.clusters[e.clusters.length-1],"EXPLODED")},[]),r.useEffect(()=>{!function(){const{svg:e,zoomG:r}=E.current;e.attr("viewBox",[0,0,t,n]).call(o.zoom().extent([[0,0],[t,n]]).scaleExtent([.25,8]).on("zoom",({transform:e})=>r.attr("transform",e)))}()},[t,n]),r.useEffect(()=>{v(),O(),j()},[f,e,i]),r.useEffect(()=>{O()},[p]),r.createElement("div",{style:{position:"fixed",left:110,top:0,height:n+"px",width:t-110+"px"}},r.createElement("svg",{width:t,height:n,ref:b}),r.createElement("div",{ref:w,style:{opacity:0,position:"absolute",pointerEvents:"none",backgroundColor:"white",maxWidth:"300px",maxHeight:"400px",overflow:"hidden",padding:"5px",border:"2px solid black"}}))}i.render(r.createElement((function(){const[e,t]=r.useState(),n=e?e.clusters.map(({label:e})=>e):void 0;r.useEffect(()=>{(async()=>{const e=await fetch("../data/data.json");t(await e.json())})()},[]);const[i,o]=r.useState("ORIGINAL");window.setMode=o;const[[l,a],c]=r.useState([window.innerWidth,window.innerHeight]);window.addEventListener("resize",()=>c([window.innerWidth,window.innerHeight]));const[s,u]=r.useState([]),[d,m]=r.useState(!1);return r.createElement("div",{style:{fontFamily:"sans-serif"}},e&&r.createElement(f,{width:l,height:a,data:e,selectedWords:s,mode:i,onData:t,hideOutlines:d}),r.createElement("h1",null,"Massmail Explorer"),r.createElement("a",{href:"https://github.com/koreanwglasses/massmail-explorer/"},"Source"),r.createElement("br",null),r.createElement("input",{type:"button",value:"Original",onClick:()=>o("ORIGINAL")}),r.createElement("br",null),r.createElement("input",{type:"button",value:"Exploded",onClick:()=>o("EXPLODED")}),r.createElement("br",null),r.createElement("input",{type:"checkbox",defaultChecked:d,onClick:e=>m(e.target.checked)}),"Fade Outlines",r.createElement("div",null,r.createElement("h2",null,"Keywords"),n&&n.map((e,t)=>r.createElement("input",{type:"button",value:e,key:t,style:{display:"flex",width:100,height:50,justifyContent:"center",alignItems:"center",borderStyle:"solid",borderWidth:"2px",borderColor:"black",borderRadius:"0px",marginBottom:"1px",backgroundColor:-1==s.indexOf(e)?"white":"black",color:-1==s.indexOf(e)?"black":"white"},onClick:()=>u(-1==s.indexOf(e)?[e]:[])}))))}),null),document.getElementById("react-root"))}]);
//# sourceMappingURL=main.js.map