!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=React},function(t,e){t.exports=d3},function(t,e){t.exports=ReactDOM},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n(2),c=n(1);const i=function(t,e){return[t*e[0],t*e[1]]},l=function(t,e){return[t[0]+e[0],t[1]+e[1]]},s=function(t,e){const n=[t[1]-e[1],e[0]-t[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/r,n[1]/r]},a=function(t,e){const n=[t[0][0],t[0][1]-e];return"M "+n+" A "+[e,e,"0,0,0",[t[0][0],t[0][1]+e]].join(",")+" A "+[e,e,"0,0,0",n].join(",")},u=function(t,e){const n=i(e,s(t[0],t[1])),r=i(-1,n),o=l(t[0],n),c=l(t[1],n),a=l(t[1],r),u=l(t[0],r);return"M "+o+" L "+c+" A "+[e,e,"0,0,0",a].join(",")+" L "+u+" A "+[e,e,"0,0,0",o].join(",")};function d(t,e=((...t)=>t.reduce((t,e)=>`${t},${e}`,""))){const n=new Map;return Object.assign((function(...r){const o=e(...r);return n.has(o)||n.set(o,t(...r)),n.get(o)}),{invalidate(){n.clear()}})}function f({data:t,width:e,height:n,selectedWords:o=[],mode:f="ORIGINAL"}){const p=[-50,-50,100],m=r.useRef(d((function(n,r){const o=h.current,c=t=>e/p[2]*(t-p[0]),i=t=>e/p[2]*(t-p[1]);if("ORIGINAL"===r)return[c(n.embedding.x),i(n.embedding.y)];if("EXPLODED"===r){const e=t.clusters.findIndex(({id:t})=>t===n.clusterId),l=o(t.clusters[e],"ORIGINAL");if(0===e)return[-l.left+c(n.embedding.x),-l.top+i(n.embedding.y)];const s=o(t.clusters[e-1],r);return s.right+l.width<2e3?[30+s.right-l.left+c(n.embedding.x),s.top+-l.top+i(n.embedding.y)]:[-l.left+c(n.embedding.x),600+s.top+-l.top+i(n.embedding.y)]}}),(t,e)=>`${t.embedding.x},${t.embedding.y},${e}`));r.useEffect(()=>{m.current.invalidate()},[t]);const g=r.useRef(d((function(e,n){const r=m.current;return t.emails.filter(t=>t.clusterId===e.id).map(t=>r(t,n))}),({id:t},e)=>`${t},${e}`));r.useEffect(()=>{g.current.invalidate()},[t]);const h=r.useRef(d((function(t,e){const n=(0,g.current)(t,e),[r,o]=c.extent(n.map(([t,e])=>t)),[i,l]=c.extent(n.map(([t,e])=>e));return{left:r,right:o,top:i,bottom:l,width:o-r,height:l-i}}),({id:t},e)=>`${t},${e}`));const y=r.useRef(),x=r.useRef(),b=r.useRef();function w(){const{circleG:e}=b.current,n=c.select(x.current),r=m.current;e.selectAll("circle").data(t.emails).join("circle").call(t=>t.transition("email-spatial-view-mode").duration(2e3).attr("cx",t=>r(t,f)[0]).attr("cy",t=>r(t,f)[1])).attr("r",3).attr("fill","#444").on("mouseenter",(function(t,e){n.text(e.content||"(no content)").style("left",t.clientX+window.scrollX+"px").style("top",t.clientY+window.scrollY+"px").style("opacity",100)})).on("mousemove",(function(t,e){n.style("left",t.clientX+window.scrollX+"px").style("top",t.clientY+window.scrollY+"px")})).on("mouseleave",(function(t,e){n.style("opacity",0)})).call(c.drag().on("start",(function(){c.select(this).raise(),e.attr("cursor","grabbing")})).on("drag",(function(t,e){c.select(this).attr("cx",t.x).attr("cy",t.y)})).on("end",(function(e,n){const r=function(t){const[e,n]=c.pointer(t);return document.elementsFromPoint(e,n).find(t=>"path"===t.tagName)}(e);if(r){const t=c.select(r).datum();n.clusterId=t.id}else{t.emails.filter(t=>t.clusterId===n.clusterId).length>1&&function(e){const n={id:Math.random()*Number.MAX_SAFE_INTEGER,label:""};t.clusters.push(n),e.clusterId=n.id}(n)}w(),v(),E()})))}function v(){const{clusterG:e}=b.current,n=g.current;e.selectAll("path").data(t.clusters).join("path").style("stroke","#444").style("stroke-width","2px").style("fill","#ccc").call(t=>t.transition("email-spatial-view-mode").duration(2e3).style("opacity",{ORIGINAL:.1,EXPLODED:1}[f]).attr("d",t=>{const e=n(t,f);return function(t,e){if(!t||t.length<1)return"";if(1===t.length)return a(t,e);if(2===t.length)return u(t,e);let n=new Array(t.length);for(let r=0;r<n.length;++r){const o=0===r?t[t.length-1]:t[r-1],c=t[r],a=i(e,s(o,c));n[r]=[l(o,a),l(c,a)]}const r="A "+[e,e,"0,0,0,"].join(",");return n=n.map((function(t,e){let o="";return 0===e&&(o="M "+n[n.length-1][1]+" "),o+=r+t[0]+" L "+t[1],o})),n.join(" ")}(e.length<3?e:c.polygonHull(e),10)}))}function E(){const{labelG:e}=b.current,n=g.current;e.selectAll("text").data(t.clusters).join("text").attr("text-anchor","middle").text(t=>t.label).call(t=>t.transition("email-spatial-view-mode").duration(2e3).attr("x",t=>{const e=n(t,f);return e.length?c.mean(c.extent(e.map(([t,e])=>t))):0}).attr("y",t=>{const e=n(t,f);return e.length?c.min(e.map(([t,e])=>e))-10-5:0}))}return r.useEffect(()=>{!function(){const t=c.select(y.current),r=t.append("g"),o=r.append("g"),i=r.append("g"),l=r.append("g");t.attr("viewBox",[0,0,e,n]).attr("font-family","sans-serif").call(c.zoom().extent([[0,0],[e,n]]).scaleExtent([.25,8]).on("zoom",({transform:t})=>r.attr("transform",t))),i.attr("cursor","grab"),b.current={svg:t,zoomG:r,clusterG:o,circleG:i,labelG:l}}(),w(),v(),E(),h.current(t.clusters[t.clusters.length-1],"EXPLODED")},[]),r.useEffect(()=>{w(),v(),E()},[f]),r.createElement("div",{style:{display:"inline-block",height:n+"px",width:e+"px"}},r.createElement("svg",{width:e,height:n,ref:y}),r.createElement("div",{ref:x,style:{opacity:0,position:"absolute",pointerEvents:"none",backgroundColor:"white",maxWidth:"300px",maxHeight:"400px",overflow:"hidden",padding:"5px",border:"2px solid black"}}))}o.render(r.createElement((function(){const[t,e]=r.useState(),n=t?t.clusters.map(({label:t})=>t):void 0;r.useEffect(()=>{(async()=>{const t=await fetch("/data/data.json");e(await t.json())})()},[]);const[o,c]=r.useState("ORIGINAL");return window.setMode=c,r.createElement(r.Fragment,null,r.createElement("h1",null,"Title"),r.createElement("div",{style:{display:"inline-block"}},r.createElement("h2",null,"Keyword Section"),n&&n.map(t=>r.createElement("input",{type:"button",value:t,style:{display:"flex",width:100,height:50,justifyContent:"center",alignItems:"center"}}))),t&&r.createElement(f,{width:1e3,height:800,data:t,selectedWords:[],mode:o}))}),null),document.getElementById("react-root"))}]);
//# sourceMappingURL=main.js.map